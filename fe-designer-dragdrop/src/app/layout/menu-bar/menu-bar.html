<div class="menu-bar" data-testid="menubar">
  <!-- File Menu -->
  <div class="menu-item-container">
    <button
      class="menu-button"
      (click)="toggleMenu('file')"
      data-testid="menu-file">
      File
    </button>
    @if (openMenu() === 'file') {
      <div class="dropdown-menu" (click)="$event.stopPropagation()">
        <button class="dropdown-item" (click)="handleNew()" data-testid="menu-file-new">
          <span>New</span>
          <span class="shortcut">Ctrl+N</span>
        </button>
        <button class="dropdown-item" (click)="handleLoadDesign()" data-testid="menu-file-load-design">
          <span>Open Report</span>
          <span class="shortcut">Ctrl+O</span>
        </button>
        <button class="dropdown-item" (click)="handleSaveDesign()" data-testid="menu-file-save-design">
          <span>Save Report</span>
          <span class="shortcut">Ctrl+S</span>
        </button>
        <button class="dropdown-item" (click)="handlePublishTemplate()" data-testid="menu-file-save">
          <span>Publish Template</span>
          <span class="shortcut">Ctrl+P</span>
        </button>
        <button class="dropdown-item" (click)="handleExportAsXhtml()" data-testid="menu-file-save">
          <span>Export as Xhtml</span>
          <span class="shortcut">Ctrl+E</span>
        </button>
        <button class="dropdown-item" (click)="handleClose()" data-testid="menu-file-close">
          <span>Close</span>
          <span class="shortcut">Ctrl+W</span>
        </button>
      </div>
    }
  </div>

  <!-- Edit Menu -->
  <div class="menu-item-container">
    <button
      class="menu-button"
      (click)="toggleMenu('edit')"
      data-testid="menu-edit">
      Edit
    </button>
    @if (openMenu() === 'edit') {
      <div class="dropdown-menu" (click)="$event.stopPropagation()">
        <button
          class="dropdown-item"
          [disabled]="!canUndo()"
          (click)="handleUndo()"
          data-testid="menu-edit-undo">
          <span>Undo</span>
        </button>
        <button
          class="dropdown-item"
          [disabled]="!canRedo()"
          (click)="handleRedo()"
          data-testid="menu-edit-redo">
          <span>Redo</span>
        </button>
        <button class="dropdown-item" (click)="handleSettings()" data-testid="menu-edit-options">
          <span>Setting</span>
          <span class="shortcut">Ctrl+Alt+S</span>
        </button>
      </div>
    }
  </div>

  <!-- View Menu -->
  <div class="menu-item-container">
    <button
      class="menu-button"
      (click)="toggleMenu('view')"
      data-testid="menu-view">
      View
    </button>
    @if (openMenu() === 'view') {
      <div class="dropdown-menu" (click)="$event.stopPropagation()">
        <button
          class="dropdown-item"
          (click)="handleZoom('fit')"
          [class.active]="canvasZoomMode() === 'fit'"
          data-testid="menu-view-zoom-fit">
          <span>Zoom To Fit</span>
          <span class="shortcut">F4</span>
        </button>
        <button
          class="dropdown-item"
          (click)="handleZoom('width')"
          [class.active]="canvasZoomMode() === 'width'"
          data-testid="menu-view-zoom-width">
          <span>Zoom To Width</span>
        </button>
        <button
          class="dropdown-item"
          (click)="handleZoom('height')"
          [class.active]="canvasZoomMode() === 'height'"
          data-testid="menu-view-zoom-height">
          <span>Zoom To Height</span>
        </button>
        <button
          class="dropdown-item"
          (click)="handleZoom('actual')"
          [class.active]="canvasZoomMode() === 'actual'"
          data-testid="menu-view-zoom-actual">
          <span>Zoom 1:1</span>
          <span class="shortcut">Shift-F4</span>
        </button>
        <button
          class="dropdown-item"
          (click)="openCalibration()"
          data-testid="menu-view-calibrate">
          <span>Calibrate Screen</span>
          <span class="shortcut">Ctrl+F12</span>
        </button>
      </div>
    }
  </div>

  <div
    class="menu-layout-name"
    [attr.title]="layoutDisplayName()"
    data-testid="menu-layout-name">
    {{ layoutDisplayName() }}
  </div>
</div>

<!-- Click outside to close menus -->
@if (openMenu()) {
  <div class="menu-overlay" (click)="closeMenu()"></div>
}
