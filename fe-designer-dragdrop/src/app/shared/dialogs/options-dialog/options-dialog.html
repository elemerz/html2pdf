<div class="dialog-overlay" (click)="onOverlayClick()">
  <div class="dialog-content" (click)="onDialogClick($event)" data-testid="dialog-options">
    <h2 class="dialog-title">Options</h2>

    <div class="dialog-body">
      <div class="accordion">
        <div
          class="accordion-section"
          [class.expanded]="isSectionExpanded('page')">
          <button
            type="button"
            class="accordion-header"
            (click)="toggleSection('page')"
            data-testid="toggle-section-page">
            <span>Page</span>
            <span class="chevron" [class.expanded]="isSectionExpanded('page')">›</span>
          </button>

          @if (isSectionExpanded('page')) {
            <div class="accordion-content">
              <div class="form-grid gutters-grid">
                <div class="form-field">
                  <label for="page-gutter-top" class="form-label">Top (mm)</label>
                  <input
                    id="page-gutter-top"
                    type="number"
                    class="form-input"
                    [ngModel]="pageGutterTop()"
                    (ngModelChange)="pageGutterTop.set(coerceNumber($event))"
                    min="0"
                    max="100"
                    step="1"
                    data-testid="input-page-gutter-top" />
                </div>
                <div class="form-field">
                  <label for="page-gutter-right" class="form-label">Right (mm)</label>
                  <input
                    id="page-gutter-right"
                    type="number"
                    class="form-input"
                    [ngModel]="pageGutterRight()"
                    (ngModelChange)="pageGutterRight.set(coerceNumber($event))"
                    min="0"
                    max="100"
                    step="1"
                    data-testid="input-page-gutter-right" />
                </div>
                <div class="form-field">
                  <label for="page-gutter-bottom" class="form-label">Bottom (mm)</label>
                  <input
                    id="page-gutter-bottom"
                    type="number"
                    class="form-input"
                    [ngModel]="pageGutterBottom()"
                    (ngModelChange)="pageGutterBottom.set(coerceNumber($event))"
                    min="0"
                    max="100"
                    step="1"
                    data-testid="input-page-gutter-bottom" />
                </div>
                <div class="form-field">
                  <label for="page-gutter-left" class="form-label">Left (mm)</label>
                  <input
                    id="page-gutter-left"
                    type="number"
                    class="form-input"
                    [ngModel]="pageGutterLeft()"
                    (ngModelChange)="pageGutterLeft.set(coerceNumber($event))"
                    min="0"
                    max="100"
                    step="1"
                    data-testid="input-page-gutter-left" />
                </div>
              </div>
            </div>
          }
        </div>

        <div
          class="accordion-section"
          [class.expanded]="isSectionExpanded('grid')">
          <button
            type="button"
            class="accordion-header"
            (click)="toggleSection('grid')"
            data-testid="toggle-section-grid">
            <span>Grid</span>
            <span class="chevron" [class.expanded]="isSectionExpanded('grid')">›</span>
          </button>

          @if (isSectionExpanded('grid')) {
            <div class="accordion-content">
              <div class="form-grid">
                <div class="form-field">
                  <label for="visual-grid-size" class="form-label">Visual Grid Size (mm)</label>
                  <span class="form-hint">Spacing between visible grid lines.</span>
                  <input
                    id="visual-grid-size"
                    type="number"
                    class="form-input"
                    [ngModel]="visualGridSize()"
                    (ngModelChange)="visualGridSize.set(coerceNumber($event))"
                    min="1"
                    max="100"
                    step="1"
                    data-testid="input-visual-grid-size" />
                </div>
                <div class="form-field">
                  <label for="logical-grid-size" class="form-label">Logical Grid Size (mm)</label>
                  <span class="form-hint">Snap increment for elements.</span>
                  <input
                    id="logical-grid-size"
                    type="number"
                    class="form-input"
                    [ngModel]="logicalGridSize()"
                    (ngModelChange)="logicalGridSize.set(coerceNumber($event))"
                    min="1"
                    max="100"
                    step="1"
                    data-testid="input-logical-grid-size" />
                </div>
                <div class="form-field color-field">
                  <label for="visual-grid-color" class="form-label">Visual Grid Color</label>
                  <span class="form-hint">Stroke color for the canvas grid.</span>
                  <input
                    id="visual-grid-color"
                    type="color"
                    class="form-input color-input"
                    [ngModel]="visualGridColor()"
                    (ngModelChange)="visualGridColor.set($event)"
                    data-testid="input-visual-grid-color" />
                </div>
              </div>
            </div>
          }
        </div>
        <div class="accordion-section" [class.expanded]="isSectionExpanded('layout')">
          <button
            type="button"
            class="accordion-header"
            (click)="toggleSection('layout')"
            data-testid="toggle-section-layout">
            <span>Layout</span>
            <span class="chevron" [class.expanded]="isSectionExpanded('layout')">›</span>
          </button>

          @if (isSectionExpanded('layout')) {
            <div class="accordion-content">
              <div class="form-grid" style="grid-template-columns: 1fr auto; align-items:center;">
                <label for="allow-vertical-only" class="form-label" style="margin:0;display:flex;align-items:center;">Allow Vertical resize only</label>
                <input id="allow-vertical-only" type="checkbox" class="form-checkbox" [ngModel]="allowVerticalResizeOnly()" (ngModelChange)="allowVerticalResizeOnly.set(!!$event)" data-testid="input-allow-vertical-only" />
                <div style="grid-column:1 / -1; font-size:12px;">Restricts table elements to top/bottom handles only.</div>
              </div>
            </div>
          }
        </div>

      </div>
    </div>

    <div class="dialog-footer">
      <button
        class="button button-secondary"
        (click)="onCancel()"
        data-testid="button-cancel">
        Cancel
      </button>
      <button
        class="button button-primary"
        (click)="onSave()"
        data-testid="button-save">
        Save
      </button>
    </div>
  </div>
</div>
